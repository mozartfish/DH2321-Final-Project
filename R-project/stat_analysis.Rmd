---
title: "Vis analysis"
author: "Group 8"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Setup and Libraries
if (!requireNamespace("ggplot2", quietly = TRUE)) install.packages("ggplot2")
if (!requireNamespace("dplyr", quietly = TRUE)) install.packages("dplyr")
if (!requireNamespace("rstatix", quietly = TRUE)) install.packages("rstatix")
if (!requireNamespace("readxl", quietly = TRUE)) install.packages("readxl")

library(dplyr)
library(tidyverse)
library(ggplot2)
library(readr)
library(rstatix)
library(readxl)
```


```{r data-loading and cleaning, include = FALSE}
# Load the dataset
sdg3 <- readxl::read_excel("xlsx/sdg_3.xlsx") 
sdg5 <- readxl::read_excel("xlsx/sdg_5.xlsx") 
sdg8 <- readxl::read_excel("xlsx/sdg_8.xlsx") 
sdg9 <- readxl::read_excel("xlsx/sdg_9.xlsx") 
sdg11 <- readxl::read_excel("xlsx/sdg_11.xlsx") 
sdg12 <- readxl::read_excel("xlsx/sdg_12.xlsx") 
sdg16 <- readxl::read_excel("xlsx/sdg_16.xlsx") 

# Inspect the data structure
#str(sdg3)
#str(sdg5)
#str(sdg8)
#str(sdg9)
#str(sdg11)
#str(sdg12)
#str(sdg16)
#summary(sdg3)
#summary(sdg3)
#summary(sdg5)
#summary(sdg8)
#summary(sdg9)
#summary(sdg11)
#summary(sdg12)
#summary(sdg16)


# Convert
sdg3$year <- as.numeric(sdg3$year)
sdg3$smoking <- as.numeric(sdg3$smoking)
sdg3$smoking <- as.numeric(gsub("[^0-9.]", "", sdg3$smoking))  # Remove non-numeric characters

sdg5$year <- as.numeric(sdg5$year)
sdg5$value <- as.numeric(sdg5$value)
sdg5$value <- as.numeric(gsub("[^0-9.]", "", sdg5$value))  # Remove non-numeric characters

sdg8$year <- as.numeric(sdg8$year)
sdg8$value <- as.numeric(sdg8$value)
sdg8$value <- as.numeric(gsub("[^0-9.]", "", sdg8$value))  # Remove non-numeric characters

sdg9$year <- as.numeric(sdg9$year)
sdg9$value <- as.numeric(sdg9$value)
sdg9$value <- as.numeric(gsub("[^0-9.]", "", sdg9$value))  # Remove non-numeric characters

sdg11$year <- as.numeric(sdg11$year)
sdg11$value <- as.numeric(sdg11$value)
sdg11$value <- as.numeric(gsub("[^0-9.]", "", sdg11$value))  # Remove non-numeric characters

sdg12$year <- as.numeric(sdg12$year)
sdg12$value <- as.numeric(sdg12$value)
sdg12$value <- as.numeric(gsub("[^0-9.]", "", sdg12$value))  # Remove non-numeric characters

sdg16$year <- as.numeric(sdg16$year)
sdg16$value <- as.numeric(sdg16$value)
sdg16$value <- as.numeric(gsub("[^0-9.]", "", sdg16$value))  # Remove non-numeric characters


```


# Data types 

The dataset has several datatypes. All of them have year and country. 

* country (Categorial): Name of EU country 
* year (Ordinal): Year in which data was recorded


### SDG 3 datatypes: 

* unit (Categorical): Measurement unit of people smoking
* sex (Categorical): Gender category
* smoking (Quantitative/Continuous): Percentage of total population that smokes

### SDG 5 datatypes: 

* unit (Categorical): Measurement unit of people outside that is outside the labour force due to caring responsibilities
* sex (Categorical): Gender category
* outside_labour_caring (Quantitative/Continuous): Percentage of total population 

### SDG 8 datatypes: 

* unit (Categorical): Measurement unit of total population that is neither employed nor in education
* sex (Categorical): Gender category
* not_emp_edu (Quantitative/Continuous): Percentage of total population

### SDG 9 datatypes: 

* unit (Categorical): Measurement unit - share of buses and trains
* vehicle (Categorical): Type of vehicle
* bus_train (Quantitative/Continuous): Percentage of of total inland passenger transport

### SDG 11 datatypes: 

* unit (Categorical): Measurement unit of deaths in road accidents
* traffic (Categorical): Type of road infrastructure
* deaths (Quantitative/Discrete): (Number/rate) of deaths in road accidents (discrete if we use numbers, continuous if we use ratio)

### SDG 12 datatypes: 

* unit (Categorical): Measurement unit (Planetary Boundary or per inhabitant)
* consumption (Quantitative/Continuous): Level of resource consumption measured against planetary boundaries or per inhabitants (Ratio)

### SDG 16 datatypes: 

* unit (Categorical): Measurement unit (Percentage)
* income_group (Categorical): Income category
* rrycrime (Quantitative/Continuous): Crime rate percentage based on the income group





# SDG 3 - Good Health and Well-Being
## Ensure healthy lives and promote well-being for all at all ages
Sustainable Development Goal (SDG) 3 aims to ensure healthy lives and promote well-being for all at all ages. It focuses on reducing maternal and child mortality, combating infectious diseases (HIV, tuberculosis, malaria), promoting universal health coverage, improving mental health, and tackling non-communicable diseases (e.g., heart disease, diabetes).


We have decided to look specifically at Smoking and how it has changed through the years.

```{r sdg3-europe, echo=FALSE}

# Keep only "Total" for gender
sdg3_total <- sdg3 %>%
  filter(sex == "Total")

# Select top 10 highest-smoking countries (from Total data)
top_countries <- sdg3_total %>%
  group_by(country) %>%
  summarise(mean_smoking = mean(smoking, na.rm = TRUE)) %>%
  arrange(desc(mean_smoking)) %>%
  slice_head(n = 10) %>%   # Keep only top 10
  pull(country)            # Extract country names as a vector

# Now filter for only these top countries
sdg3_top <- sdg3_total %>%
  filter(country %in% top_countries)

ggplot(sdg3_total, aes(x = year, y = smoking, color = country, group = country)) +
  geom_line() + 
  geom_point() +
  labs(title = "Smoking Trends Over the Years (Total Population)",
       x = "Year",
       y = "Percentage of Population",
       color = "Country") +
  theme_minimal()

ggplot(sdg3_top, aes(x = year, y = reorder(country, -smoking), fill = smoking)) +
  geom_tile(color = "white") +
  scale_fill_viridis_c(option = "magma", name = "Smoking %") +
  labs(title = "Top 10 Countries by Smoking Rates (Heatmap)",
       x = "Year",
       y = "Country") +
  theme_minimal()



```
```{r sdg 3 statistics, europe, echo=FALSE}

# Check column names
#colnames(sdg3)

# Check data types
#str(sdg3)

# Count observations per year
#table(sdg3$year)

# Display the first few rows
#head(sdg3)


# Filter for years 2006 and 2020 AND keep only "Total" category in sex
filter_sdg3 <- sdg3 %>%
  filter(year %in% c(2006, 2020) & sex == "Total")

# Check if filtering worked correctly
#unique(filter_sdg3$year)  # Should return 2006, 2020

# Summarize the data
filter_sdg3 %>%
  group_by(year) %>%
  summarise(mean_smoking = mean(smoking, na.rm = TRUE),
            sd_smoking = sd(smoking, na.rm = TRUE),
            count = n())

# Independent t-test
t_test_result <- t.test(smoking ~ year, data = filter_sdg3)
print(t_test_result)

```
A Welchâ€™s independent t-test was conducted to compare smoking rates between 2006 and 2020. The results indicated a statistically significant decrease in smoking rates over time, t(48.94) = 3.78, p < .001, 95% CI [2.93, 9.60]. The mean smoking rate in 2006 (M = 30.47, SD = 4.85) was significantly higher than in 2020 (M = 24.20, SD = 7.68), suggesting a notable decline in smoking prevalence over the 14-year period.



# Nordics isolated

```{r sdg 3 nordics, echo=FALSE}

filtered_sdg3 <- sdg3[sdg3$country %in% c("Sweden", "Finland", "Denmark"), ]

ggplot(filtered_sdg3, aes(x = year, y = smoking, color = sex, group = sex)) +
  geom_line() + 
  geom_point() +
  facet_wrap(~ country) +  # Separate plots for each country
  labs(title = "Smoking Trends Over the Years",
       x = "Year",
       y = "Percentage of Population",
       color = "Gender") +
  theme_minimal()


ggplot(filtered_sdg3, aes(x = year, y = smoking, color = country, linetype = sex, group = interaction(country, sex))) +
  geom_line() + 
  geom_point() +
  labs(title = "Smoking Trends Over the Years",
       x = "Year",
       y = "Percentage of Population",
       color = "Country",
       linetype = "Gender") +
  theme_minimal()


```






# SDG 5 - Gender Equality
## Achieve gender equality and empower all women and girls
Sustainable Development Goal (SDG) 5 aims to achieve gender equality and empower all women and girls. It focuses on eliminating discrimination, violence, and harmful practices (e.g., child marriage, female genital mutilation), ensuring equal opportunities in leadership and economic participation, and universal access to sexual and reproductive health rights.


We have decided to look at... 


# SDG 8 - Decent Work and Economic Growth
## Promote sustained, inclusive and sustainable economic growth, full and productive employment and decent work for all
Sustainable Development Goal (SDG) 8 aims to promote inclusive and sustainable economic growth, full and productive employment, and decent work for all. It focuses on:

* Sustained GDP growth and increased productivity
* Job creation and entrepreneurship
* Labor rights and safe working conditions
* Ending modern slavery, forced labor, and child labor
* Financial inclusion and equal access to economic resources


We have decided to look at... 


# SDG 9 - Industry, Innovation, and Infrastructure
## Build resilient infrastructure, promote inclusive and sustainable industrialization and foster innovation
Sustainable Development Goal (SDG) 9 aims to build resilient infrastructure, promote sustainable industrialization, and foster innovation. It focuses on:

* Expanding reliable and sustainable infrastructure (transport, energy, digital access).
* Supporting inclusive and sustainable industrialization with job creation.
* Increasing investment in R&D and innovation, especially in developing industries.
* Promoting clean technologies and environmentally friendly production.


We have decided to look at... 


# SDG 11 - Sustainable Cities and Communities
## Make cities and human settlements inclusive, safe, resilient and sustainable
Sustainable Development Goal (SDG) 11 aims to make cities inclusive, safe, resilient, and sustainable. It focuses on:

* Affordable housing and reducing slums.
* Sustainable urban transport and mobility.
* Reducing air pollution and environmental impact.
* Disaster risk reduction and climate resilience.
* Preserving cultural and natural heritage.


We have decided to look at... 


# SDG 12 - Responsible Consumption and Production
## Ensure sustainable consumption and production patterns
Sustainable Development Goal (SDG) 12 aims to ensure sustainable consumption and production patterns by:

* Reducing waste and pollution (food waste, plastic, industrial emissions).
* Promoting circular economy models (recycling, reusing, and reducing resource use).
* Encouraging sustainable business practices and corporate responsibility.
* Improving resource efficiency in production and supply chains.
* Raising awareness about sustainable consumption among individuals and businesses.


We have decided to look at... 



# SDG 16 - Peace, Justice, and Strong Institutions
## Promote peaceful and inclusive societies for sustainable development, provide access to justice for all and build effective, accountable and inclusive institutions at all levels
Sustainable Development Goal (SDG) 16 aims to promote peaceful and inclusive societies, provide access to justice for all, and build effective, accountable institutions. It focuses on:

* Reducing violence, corruption, and organized crime.
* Ensuring access to justice and human rights for all individuals.
* Strengthening democratic institutions and governance.
* Protecting fundamental freedoms and promoting transparency.
* Reducing illicit financial flows and bribery.


We have decided to look at... 



```{r session-info, include=FALSE}
# Session info for reproducibility
sessionInfo()
